<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Mongrel::Configurator</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Mongrel::Configurator</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/mongrel/configurator_rb.html">
                lib/mongrel/configurator.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Implements a simple DSL for configuring a <a
href="../Mongrel.html">Mongrel</a> server for your purposes. More used by
framework implementers to setup <a href="../Mongrel.html">Mongrel</a> how
they like, but could be used by regular folks to add more things to an
existing mongrel configuration.
</p>
<p>
It is used like this:
</p>
<pre>
  require 'mongrel'
  config = Mongrel::Configurator.new :host =&gt; &quot;127.0.0.1&quot; do
    listener :port =&gt; 3000 do
      uri &quot;/app&quot;, :handler =&gt; Mongrel::DirHandler.new(&quot;.&quot;, load_mime_map(&quot;mime.yaml&quot;))
    end
    run
  end
</pre>
<p>
This will setup a simple <a href="DirHandler.html">DirHandler</a> at the
current directory and load additional mime types from mimy.yaml. The :host
=&gt; &quot;127.0.0.1&quot; is actually not specific to the servers but
just a hash of default parameters that all server or <a
href="Configurator.html#M000092">uri</a> calls receive.
</p>
<p>
When you are inside the block after <a
href="Configurator.html#M000084">Mongrel::Configurator.new</a> you can
simply call functions that are part of <a
href="Configurator.html">Configurator</a> (like server, <a
href="Configurator.html#M000092">uri</a>, <a
href="Configurator.html#M000093">daemonize</a>, etc) without having to
refer to anything else. You can also call these functions on the resulting
object directly for additional configuration.
</p>
<p>
A major thing about <a href="Configurator.html">Configurator</a> is that it
actually lets you configure multiple listeners for any hosts and ports you
want. These are kept in a map config.listeners so you can get to them.
</p>
<ul>
<li>:pid_file =&gt; Where to write the process ID.

</li>
</ul>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000085">change_privilege</a>&nbsp;&nbsp;
      <a href="#M000089">cloaker</a>&nbsp;&nbsp;
      <a href="#M000088">cloaking_class</a>&nbsp;&nbsp;
      <a href="#M000093">daemonize</a>&nbsp;&nbsp;
      <a href="#M000102">debug</a>&nbsp;&nbsp;
      <a href="#M000101">join</a>&nbsp;&nbsp;
      <a href="#M000091">listener</a>&nbsp;&nbsp;
      <a href="#M000096">load_mime_map</a>&nbsp;&nbsp;
      <a href="#M000094">load_plugins</a>&nbsp;&nbsp;
      <a href="#M000095">load_yaml</a>&nbsp;&nbsp;
      <a href="#M000105">log</a>&nbsp;&nbsp;
      <a href="#M000084">new</a>&nbsp;&nbsp;
      <a href="#M000097">plugin</a>&nbsp;&nbsp;
      <a href="#M000098">redirect</a>&nbsp;&nbsp;
      <a href="#M000086">remove_pid_file</a>&nbsp;&nbsp;
      <a href="#M000090">resolve_defaults</a>&nbsp;&nbsp;
      <a href="#M000099">run</a>&nbsp;&nbsp;
      <a href="#M000103">run_config</a>&nbsp;&nbsp;
      <a href="#M000104">setup_signals</a>&nbsp;&nbsp;
      <a href="#M000100">stop</a>&nbsp;&nbsp;
      <a href="#M000092">uri</a>&nbsp;&nbsp;
      <a href="#M000087">write_pid_file</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">defaults</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">listeners</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">needs_restart</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000084" class="method-detail">
        <a name="M000084"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000084.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000084.html');return false;">
          <span class="method-name">new</span><span class="method-args">(defaults={}, &amp;blk)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
You pass in initial defaults and then a block to continue configuring.
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000085" class="method-detail">
        <a name="M000085"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000085.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000085.html');return false;">
          <span class="method-name">change_privilege</span><span class="method-args">(user, group)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Change privilege of the process to specified user and group.
</p>
        </div>
      </div>

      <div id="method-M000089" class="method-detail">
        <a name="M000089"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000089.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000089.html');return false;">
          <span class="method-name">cloaker</span><span class="method-args">(&amp;blk)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do not call this. You were warned.
</p>
        </div>
      </div>

      <div id="method-M000088" class="method-detail">
        <a name="M000088"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000088.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000088.html');return false;">
          <span class="method-name">cloaking_class</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
generates a class for cloaking the current self and making the DSL nicer
</p>
        </div>
      </div>

      <div id="method-M000093" class="method-detail">
        <a name="M000093"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000093.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000093.html');return false;">
          <span class="method-name">daemonize</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Daemonizes the current Ruby script turning all the listeners into an actual
&quot;server&quot; or detached process. You must call this <b>before</b>
frameworks that open files as otherwise the files will be closed by this
function.
</p>
<p>
Does not work for Win32 systems (the call is silently ignored).
</p>
<p>
Requires the following options or defaults:
</p>
<ul>
<li>:cwd =&gt; Directory to change to.

</li>
<li>:log_file =&gt; Where to write STDOUT and STDERR.

</li>
</ul>
<p>
It is safe to call this on win32 as it will only require the daemons
gem/library if NOT win32.
</p>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000102.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000102.html');return false;">
          <span class="method-name">debug</span><span class="method-args">(location, what = [:access, :files, :objects, :threads, :rails])</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calling this before you register your URIs to the given location will setup
a set of handlers that <a href="Configurator.html#M000105">log</a> open
files, objects, and the parameters for each request. This helps you track
common problems found in <a href="Rails.html">Rails</a> applications that
are either slow or become unresponsive after a little while.
</p>
<p>
You can pass an extra parameter <b>what</b> to indicate what you want to <a
href="Configurator.html#M000102">debug</a>. For example, if you just want
to dump rails stuff then do:
</p>
<pre>
  debug &quot;/&quot;, what = [:rails]
</pre>
<p>
And it will only produce the log/mongrel_debug/rails.log file. Available
options are: :access, :files, :objects, :threads, :rails
</p>
<p>
NOTE: Use [:files] to get accesses dumped to stderr like with WEBrick.
</p>
        </div>
      </div>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000101.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000101.html');return false;">
          <span class="method-name">join</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method should actually be called <b>outside</b> of the <a
href="Configurator.html">Configurator</a> block so that you can control it.
In other words do it like: config.join.
</p>
        </div>
      </div>

      <div id="method-M000091" class="method-detail">
        <a name="M000091"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000091.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000091.html');return false;">
          <span class="method-name">listener</span><span class="method-args">(options={},&amp;blk)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts a <a href="Configurator.html#M000091">listener</a> block. This is
the only one that actually takes a block and then you make <a
href="Configurator.html#M000092">Configurator.uri</a> calls in order to
setup your URIs and handlers. If you write your Handlers as GemPlugins then
you can use <a href="Configurator.html#M000094">load_plugins</a> and <a
href="Configurator.html#M000097">plugin</a> to load them.
</p>
<p>
It expects the following options (or defaults):
</p>
<ul>
<li>:host =&gt; Host name to bind.

</li>
<li>:port =&gt; Port to bind.

</li>
<li>:num_processors =&gt; The maximum number of concurrent threads allowed.
(950 default)

</li>
<li>:timeout =&gt; 1/100th of a second timeout between requests. (10 is 1/10th,
0 is timeout)

</li>
<li>:user =&gt; User to change to, must have :group as well.

</li>
<li>:group =&gt; Group to change to, must have :user as well.

</li>
</ul>
        </div>
      </div>

      <div id="method-M000096" class="method-detail">
        <a name="M000096"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000096.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000096.html');return false;">
          <span class="method-name">load_mime_map</span><span class="method-args">(file, mime={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads the MIME map file and checks that it is correct on loading. This is
commonly passed to <a href="DirHandler.html">Mongrel::DirHandler</a> or any
framework handler that uses <a href="DirHandler.html">DirHandler</a> to
serve files. You can also include a set of default MIME types as additional
settings. See <a href="DirHandler.html">Mongrel::DirHandler</a> for how the
MIME types map is organized.
</p>
        </div>
      </div>

      <div id="method-M000094" class="method-detail">
        <a name="M000094"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000094.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000094.html');return false;">
          <span class="method-name">load_plugins</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Uses the GemPlugin system to easily load plugins based on their gem
dependencies. You pass in either an :includes =&gt; [] or :excludes =&gt;
[] setting listing the names of plugins to include or exclude from the when
determining the dependencies.
</p>
        </div>
      </div>

      <div id="method-M000095" class="method-detail">
        <a name="M000095"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000095.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000095.html');return false;">
          <span class="method-name">load_yaml</span><span class="method-args">(file, default={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Easy way to load a YAML file and apply default settings.
</p>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000105.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000105.html');return false;">
          <span class="method-name">log</span><span class="method-args">(msg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Logs a simple message to STDERR (or the mongrel <a
href="Configurator.html#M000105">log</a> if in daemon mode).
</p>
        </div>
      </div>

      <div id="method-M000097" class="method-detail">
        <a name="M000097"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000097.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000097.html');return false;">
          <span class="method-name">plugin</span><span class="method-args">(name, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads and creates a <a href="Configurator.html#M000097">plugin</a> for you
based on the given name and configured with the selected options. The
options are merged with the defaults prior to passing them in.
</p>
        </div>
      </div>

      <div id="method-M000098" class="method-detail">
        <a name="M000098"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000098.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000098.html');return false;">
          <span class="method-name">redirect</span><span class="method-args">(from, pattern, replacement = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lets you do redirects easily as described in <a
href="RedirectHandler.html">Mongrel::RedirectHandler</a>. You use it inside
the configurator like this:
</p>
<pre>
  redirect(&quot;/test&quot;, &quot;/to/there&quot;) # simple
  redirect(&quot;/to&quot;, /t/, 'w') # regexp
  redirect(&quot;/hey&quot;, /(w+)/) {|match| ...}  # block
</pre>
        </div>
      </div>

      <div id="method-M000086" class="method-detail">
        <a name="M000086"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000086.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000086.html');return false;">
          <span class="method-name">remove_pid_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000090" class="method-detail">
        <a name="M000090"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000090.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000090.html');return false;">
          <span class="method-name">resolve_defaults</span><span class="method-args">(options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This will resolve the given options against the defaults. Normally just
used internally.
</p>
        </div>
      </div>

      <div id="method-M000099" class="method-detail">
        <a name="M000099"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000099.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000099.html');return false;">
          <span class="method-name">run</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Works like a meta <a href="Configurator.html#M000099">run</a> method which
goes through all the configured listeners. Use the <a
href="Configurator.html#M000101">Configurator.join</a> method to prevent
Ruby from exiting until each one is done.
</p>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000103.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000103.html');return false;">
          <span class="method-name">run_config</span><span class="method-args">(script)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used to allow you to let users specify their own configurations inside your
<a href="Configurator.html">Configurator</a> setup. You pass it a script
name and it reads it in and does an eval on the contents passing in the
right binding so they can put their own <a
href="Configurator.html">Configurator</a> statements.
</p>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000104.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000104.html');return false;">
          <span class="method-name">setup_signals</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up the standard signal handlers that are used on most Ruby It only
configures if the platform is not win32 and doesn&#8216;t do a HUP signal
since this is typically framework specific.
</p>
<p>
Requires a :pid_file option given to <a
href="Configurator.html#M000084">Configurator.new</a> to indicate a file to
delete. It sets the MongrelConfig.needs_restart attribute if the start
command should reload. It&#8216;s up to you to detect this and do whatever
is needed for a &quot;restart&quot;.
</p>
<p>
This command is safely ignored if the platform is win32 (with a warning)
</p>
        </div>
      </div>

      <div id="method-M000100" class="method-detail">
        <a name="M000100"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000100.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000100.html');return false;">
          <span class="method-name">stop</span><span class="method-args">(needs_restart=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls .<a href="Configurator.html#M000100">stop</a> on all the configured
listeners so they <a href="Configurator.html#M000100">stop</a> processing
requests (gracefully). By default it assumes that you don&#8216;t want to
restart.
</p>
        </div>
      </div>

      <div id="method-M000092" class="method-detail">
        <a name="M000092"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000092.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000092.html');return false;">
          <span class="method-name">uri</span><span class="method-args">(location, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called inside a <a
href="Configurator.html#M000091">Configurator.listener</a> block in order
to add URI-&gt;handler mappings for that <a
href="Configurator.html#M000091">listener</a>. Use this as many times as
you like. It expects the following options or defaults:
</p>
<ul>
<li>:handler =&gt; <a href="HttpHandler.html">HttpHandler</a> &#8212; Handler
to use for this location.

</li>
<li>:in_front =&gt; true/false &#8212; Rather than appending, it prepends this
handler.

</li>
</ul>
        </div>
      </div>

      <div id="method-M000087" class="method-detail">
        <a name="M000087"></a>

        <div class="method-heading">
          <a href="Configurator.src/M000087.html" target="Code" class="method-signature"
            onclick="popupCode('Configurator.src/M000087.html');return false;">
          <span class="method-name">write_pid_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes the PID file but only if we&#8216;re on windows.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>